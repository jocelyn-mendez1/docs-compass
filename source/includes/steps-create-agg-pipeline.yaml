title: Add an aggregation pipeline stage.
level: 4
ref: add-pipeline-stage
content: |

   In the aggregation pipeline pane in the lower-left corner,
   click the :guilabel:`Select...` dropdown and select the
   :manual:`aggregation pipeline stage
   </reference/operator/aggregation-pipeline/>` to use for the first
   stage of the pipeline:

   .. figure:: /images/compass/agg-builder-select-stage.png
      :alt: Aggregation Builder select stage
---
title: Fill in the pipeline stage.
level: 4
ref: fill-in-stage
content: |
   Fill in your selected stage. If you enable :guilabel:`Auto Preview`,
   preview documents update automatically to the right of the stage to
   reflect the results of your pipeline as it progresses. You can adjust
   the width of the pipeline stage by dragging its border to the right.

   .. figure:: /images/compass/agg-builder-match-stage.png
      :alt: Aggregation Builder match stage example

---
title: Add additional pipeline stages.
level: 4
ref: add-additional-stages
content: |
   Click :guilabel:`Add Stage` to add additional aggregation stages
   below your last aggregation stage.
   Repeat steps 1 and 2 for each additional stage.

   .. note::

      The toggle to the right of the name of each pipeline stage
      dictates whether that stage is included in the pipeline. Toggling
      a pipeline stage also updates the pipeline preview, which reflects
      whether or not that stage is included.

      .. example::

         The following pipeline excludes the first
         :manual:`$match </reference/operator/aggregation/match/>` stage
         and only includes the
         :manual:`$project </reference/operator/aggregation/project/>`
         stage:

         .. figure:: /images/compass/agg-builder-exclude-stage-example.png
            :alt: Aggregation Builder exclude stage example
---
title: Run the pipeline.
level: 4
ref: run-aggregation
content: |
  Click :guilabel:`Run` at the top right of the pipeline builder. 
  |compass-short| returns your results in the document view.

  .. warning::

     When you click :guilabel:`Run`, the aggregation runs against the entire 
     collection.

  .. figure:: /images/compass/run-results.png
       :alt: Results after Running Aggregation
---
title: Edit the pipeline.
level: 4
ref: edit-after-run
content: |
   Click :guilabel:`Edit` at the top of your pipeline toolbar to return to the 
   aggregation pipeline builder. You can make changes to your pipeline from 
   there.
...
