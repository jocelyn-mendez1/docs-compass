.. _in-use-encryption-tab:

=================
In-Use Encryption 
=================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The :guilabel:`In-Use Encryption` connection tab allows you to connect your
deployments using :v6.0:`Queryable Encryption </core/queryable-encryption/>`.

In-Use Encryption is an Enterprise/Atlas only feature. You need a replica set 
to use this connection option. 

Procedure
---------

.. procedure::
   :style: normal

   .. step:: Click :guilabel:`Advanced Connection Options`.

      .. figure:: /images/compass/advanced-connection-options.png
         :figwidth: 690px
         :alt: New Advanced Connection Options

   .. step:: Click the :guilabel:`In-Use Encryption` tab.

      .. procedure::
         :style: connected

         .. step:: Provide a :guilabel:`Key Vault Namespace`.

            A :guilabel:`Key Vault Namespace` refers to a collection that 
            contains all the data keys used for encryption and decryption. 

            Specify a collection in which data encryption keys are stored in 
            the format ``<db>.<collection>``. The non-official default 
            database/collection for keyVault is ``encryption._keyVault``.

         .. step:: Select a :guilabel:`KMS Provider`.

            You can select from the following Key Management Systems: 

            - :ref:`Local KMS <local-kms>`
            
            - :ref:`AWS <aws-compass-encryption>`
            
            - :ref:`GCP <gcp-compass-encryption>`
            
            - :ref:`Azure <azure-compass-encryption>`
            
            - :ref:`KMIP <kmip-compass-encryption>`

            .. _local-kms:

            Local KMS
            ~~~~~~~~~

            You can locally manage your key as a KMS using the 
            :v6.0:`Local KMS </core/queryable-encryption/fundamentals/kms-providers/#local-key-provider>`
            option.  

            Click :guilabel:`Generate Random Key` to generate a 96-byte long 
            base64-encoded string. You need this key to access encrypted and 
            decrypted data.

            .. warning::

               |compass-short| does not save KMS credentials by default. Copy 
               and save the key in an external location.

            .. _aws-compass-encryption:

            AWS
            ~~~

            You can use :v6.0:`AWS </core/queryable-encryption/fundamentals/kms-providers/#amazon-web-services-kms>` 
            to manage your keys.

            Specify the following fields:

            .. list-table::
               :header-rows: 1 
               :widths: 30 70 30

               * - Field
                 - Description 
                 - Required

               * - Access Key Id 
                 - Value of your AWS access key Id.
                 - Yes

               * - Secret Access Key
                 - Value of your AWS secret key.
                 - Yes

               * - Session Token
                 - Value of your AWS session token. 
                 - No
               
               * - Certificate Authority
                 - One or more certificate files from trusted Certificate 
                   Authorities to validate the certificate provided by the deployment.
                 - No
               
               * - Client Certificate and Key
                 - Specifies the location of a local .pem file that contains 
                   either the client's TLS/SSL X.509 certificate or the client's TLS/SSL 
                   certificate and key.
                 - No
                
               * - Client Key Password
                 - If the *Client Private Key* is protected with a password, 
                   you must provide the password.
                 - No

            .. _gcp-compass-encryption:

            GCP
            ~~~

            You can use :v6.0:`Google Cloud Services </core/queryable-encryption/fundamentals/kms-providers/#google-cloud-platform-kms>` to manage your keys.

            Specify the following fields:

            .. list-table::
               :header-rows: 1 
               :widths: 30 70 30

               * - Field
                 - Description 
                 - Required

               * - Service Account Email
                 - The service account email to authenticate.
                 - Yes

               * - Private Key
                 - A base64-encoded private key.
                 - Yes

               * - Endpoint
                 - A host with an optional port.
                 - No

               * - Certificate Authority
                 - One or more certificate files from trusted Certificate 
                   Authorities to validate the certificate provided by the deployment.
                 - No
               
               * - Client Certificate and Key
                 - Specifies the location of a local .pem file that contains 
                   either the client's TLS/SSL X.509 certificate or the client's TLS/SSL 
                   certificate and key.
                 - No
                
               * - Client Key Password
                 - If the *Client Private Key* is protected with a password, 
                   you must provide the password.
                 - No

            .. _azure-compass-encryption:

            Azure
            ~~~~~

            You can use :v6.0:`Azure Key Vault </core/queryable-encryption/fundamentals/kms-providers/#azure-key-vault>` to manage your 
            keys.

            Specify the following fields:

            .. list-table::
               :header-rows: 1 
               :widths: 30 70 30

               * - Field
                 - Description 
                 - Required

               * - Tenant Id 
                 - Identifies the organization for the account.
                 - Yes

               * - Client Id 
                 - Authenticates a registered application.
                 - Yes

               * - Client Secret
                 - The client secret to authenticate a registered application.
                 - Yes

               * - Identity Platform Endpoint
                 - A host with an optional port. 
                 - Yes

               * - Certificate Authority
                 - One or more certificate files from trusted Certificate 
                   Authorities to validate the certificate provided by the deployment.
                 - No
               
               * - Client Certificate and Key
                 - Specifies the location of a local .pem file that contains 
                   either the client's TLS/SSL X.509 certificate or the client's TLS/SSL 
                   certificate and key.
                 - No

               * - Client Key Password
                 - If the *Client Private Key* is protected with a password, 
                   you must provide the password.  
                 - No


            .. _kmip-compass-encryption:

            KMIP
            ~~~~

            You can use :v6.0:`KMIP </core/queryable-encryption/fundamentals/kms-providers/#kmip>` 
            to manage your keys. 

            .. list-table::
               :header-rows: 1 
               :widths: 30 70 30

               * - Field
                 - Description 
                 - Required

               * - Endpoint
                 - The endpoint consists of a hostname and port separated by a colon.
                 - Yes

               * - Certificate Authority
                 - One or more certificate files from trusted Certificate 
                   Authorities to validate the certificate provided by the deployment.
                 - No

               * - Client Certificate and Key
                 - Specifies the location of a local .pem file that contains 
                   either the client's TLS/SSL X.509 certificate or the client's TLS/SSL 
                   certificate and key.
                 - No

               * - Client Key Password
                 - If the *Client Private Key* is protected with a password, 
                   you must provide the password.
                 - No 

        .. step:: (Optional) Specify an EncryptedFieldsMap

            Add an optional client-side EncryptedFieldsMap for enhanced security.

            For more information, see :v6.0:`Fields for Encryption </core/queryable-encryption/fundamentals/encrypt-and-query/#std-label-qe-fundamentals-encrypt-query>`.

   .. step::  Click Connect.
